
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2008, Adam Kubach
//  All rights reserved.
//  BSD License: http://www.opensource.org/licenses/bsd-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  Job to download file.
//
///////////////////////////////////////////////////////////////////////////////

#include "Minerva/Layers/OSM/DownloadJob.h"

#include "Minerva/Core/Utilities/Download.h"

using namespace Minerva::Layers::OSM;

USUL_IMPLEMENT_TYPE_ID ( DownloadJob );


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

DownloadJob::DownloadJob ( const std::string &url, const std::string &filename ) : BaseClass(),
  _url ( url ),
  _filename ( filename ),
  _success ( false )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor.
//
///////////////////////////////////////////////////////////////////////////////

DownloadJob::~DownloadJob()
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Start the download.
//
///////////////////////////////////////////////////////////////////////////////

void DownloadJob::_started()
{
  const bool success ( Minerva::Core::Utilities::downloadToFile ( _url, _filename ) );

  Guard guard ( this );
  _success = success;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Was it successful?
//
///////////////////////////////////////////////////////////////////////////////

bool DownloadJob::success() const
{
  Guard guard ( this );
  return _success;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the filename we downloaded to.
//
///////////////////////////////////////////////////////////////////////////////

std::string DownloadJob::filename() const
{
  Guard guard ( this );
  return _filename;
}
