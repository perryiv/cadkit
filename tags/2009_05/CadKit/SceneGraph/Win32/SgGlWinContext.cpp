
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2002, Perry L. Miller IV
//  All rights reserved.
//  BSD License: http://www.opensource.org/licenses/bsd-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  SgGlWinContext: The Win32 OpenGL context class.
//
///////////////////////////////////////////////////////////////////////////////

#include "SgGlWinContext.h"
#include "SgGlWinContextImpl.h"

#include "Standard/SlAssert.h"
#include "Standard/SlPrint.h"

using namespace CadKit;

SL_IMPLEMENT_DYNAMIC_CLASS(SgGlWinContext,SgGlContext);


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

SgGlWinContext::SgGlWinContext() : SgGlContext(), 
  _context ( new SgGlWinContextImpl )
{
  SL_PRINT2 ( "SgGlWinContext::SgGlWinContext(), this = %X\n", this );
  SL_ASSERT ( 0x0 != _context.get() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor.
//
///////////////////////////////////////////////////////////////////////////////

SgGlWinContext::~SgGlWinContext()
{
  SL_PRINT2 ( "SgGlWinContext::~SgGlWinContext(), this = %X\n", this );

  // Nothing to delete, _context is an auto_ptr.
}


///////////////////////////////////////////////////////////////////////////////
//
//  Create the context.
//
///////////////////////////////////////////////////////////////////////////////

bool SgGlWinContext::create ( void *theWindow )
{
  SL_ASSERT ( this && _context && theWindow );

  // Delegate.
  return _context->create ( theWindow );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Make this class's rendering context the current one.
//
///////////////////////////////////////////////////////////////////////////////

bool SgGlWinContext::makeCurrent()
{
  SL_ASSERT ( this && _context );

  // If we are already current then just return.
  if ( true == this->isCurrent() )
    return true;

  // Delegate.
  if ( false == _context->makeCurrent() )
    return false;

  // Call the base class's function.
  return SgGlContext::makeCurrent();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Swap the buffers.
//
///////////////////////////////////////////////////////////////////////////////

bool SgGlWinContext::swapBuffers()
{
  // Make sure this context is current.
  if ( false == this->makeCurrent() )
    return false;

  // Delegate.
  return _context->swapBuffers();
}
