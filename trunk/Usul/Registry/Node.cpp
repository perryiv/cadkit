
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2002, Perry L. Miller IV
//  All rights reserved.
//  BSD License: http://www.opensource.org/licenses/bsd-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  Node class for the registry.
//
///////////////////////////////////////////////////////////////////////////////

#include "Usul/Registry/Node.h"
#include "Usul/Registry/Visitor.h"
#include "Usul/Trace/Trace.h"

using namespace Usul;
using namespace Usul::Registry;

USUL_IMPLEMENT_TYPE_ID ( Node );


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

Node::Node() : BaseClass(),
  _value(),
  _kids()
{
  USUL_TRACE_SCOPE;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor.
//
///////////////////////////////////////////////////////////////////////////////

Node::~Node()
{
  USUL_TRACE_SCOPE;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Accept the visitor.
//
///////////////////////////////////////////////////////////////////////////////

void Node::accept ( Visitor *v )
{
  USUL_TRACE_SCOPE;

  if ( 0x0 != v )
  {
    v->visit ( this );
  }
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the value.
//
///////////////////////////////////////////////////////////////////////////////

void Node::set ( const std::string &s )
{
  USUL_TRACE_SCOPE;
  Guard guard ( this );
  _value = s;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

std::string Node::_getValue() const
{
  USUL_TRACE_SCOPE;
  Guard guard ( this );
  return std::string ( _value.begin(), _value.end() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

std::string Node::get() const
{
  USUL_TRACE_SCOPE;
  return this->_getValue();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Clear the database.
//
///////////////////////////////////////////////////////////////////////////////

void Node::clear()
{
  USUL_TRACE_SCOPE;
  Guard guard ( this );
  _value.clear();
  _kids.clear();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Operator to return the child with the name. Creates child nodes as needed.
//
///////////////////////////////////////////////////////////////////////////////

Node &Node::operator [] ( const std::string &name )
{
  Kids::iterator i ( _kids.find ( name ) );
  Node::RefPtr child ( ( _kids.end() == i ) ? 0x0 : i->second );
  if ( false == child.valid() )
  {
    child = new Node;
    child->name ( name );
    _kids.insert ( Kids::value_type ( name, child ) );
  }
  return *child;
}
