
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2007, Arizona State University
//  All rights reserved.
//  BSD License: http://www.opensource.org/licenses/bsd-license.html
//  Created by: Adam Kubach
//
///////////////////////////////////////////////////////////////////////////////

#include "ImageLayer.h"

#include "Usul/Strings/Managed.h"
#include "Magrathea/ImageTextureLayer.h"

using namespace CadKit::OSSIMPlanet::Glue;


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

ImageLayer::ImageLayer( System::String ^filename )
{
  _imageLayer = new Magrathea::ImageTextureLayer( Usul::Strings::convert ( filename ) );
  Usul::Pointers::reference ( _imageLayer );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

ImageLayer::ImageLayer( Magrathea::ImageTextureLayer* layer ) : _imageLayer ( layer )
{
  Usul::Pointers::reference ( _imageLayer );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor.
//
///////////////////////////////////////////////////////////////////////////////

ImageLayer::~ImageLayer()
{
  Usul::Pointers::unreference( _imageLayer );
  _imageLayer = 0x0;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Finalizer.
//
///////////////////////////////////////////////////////////////////////////////

ImageLayer::!ImageLayer()
{
  Usul::Pointers::unreference( _imageLayer );
  _imageLayer = 0x0;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the texture layer state code.
//
///////////////////////////////////////////////////////////////////////////////

ImageLayer::TextureLayerStateCode ImageLayer::StateCode::get()
{
  if( 0x0 != _imageLayer )
    return static_cast < TextureLayerStateCode > ( _imageLayer->getStateCode() );
  return TextureLayerStateCode::NO_SOURCE_DATA;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the Guid.
//
///////////////////////////////////////////////////////////////////////////////

System::String^ ImageLayer::Guid::get()
{
  return gcnew System::String ( _imageLayer->guid().c_str() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the name of the layer.
//
///////////////////////////////////////////////////////////////////////////////

System::String^ ImageLayer::Name::get()
{
  return gcnew System::String ( _imageLayer->filename().c_str() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the shown flag.
//
///////////////////////////////////////////////////////////////////////////////

bool ImageLayer::Shown::get()
{
  return true;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the System::IntPtr.
//
///////////////////////////////////////////////////////////////////////////////

System::IntPtr ImageLayer::nativeIntPtr()
{
  return System::IntPtr ( _imageLayer->queryInterface( Usul::Interfaces::IUnknown::IID ) );
}
