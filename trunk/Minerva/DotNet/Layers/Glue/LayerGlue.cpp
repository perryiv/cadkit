
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2006, Decision Theater
//  All rights reserved.
//  Created by: Adam Kubach
//
///////////////////////////////////////////////////////////////////////////////

#include "LayerGlue.h"

using namespace DT::Minerva::Glue;


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

LayerGlue::LayerGlue() : _connection( nullptr )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Copy Constructor.
//
///////////////////////////////////////////////////////////////////////////////

LayerGlue::LayerGlue( LayerGlue ^ layer ) :
_connection ( layer->_connection ),
_colorFunctor( layer->_colorFunctor )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor.
//
///////////////////////////////////////////////////////////////////////////////

LayerGlue::~LayerGlue()
{
  _connection = nullptr;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Finalizer.
//
///////////////////////////////////////////////////////////////////////////////

LayerGlue::!LayerGlue()
{
  _connection = nullptr;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the native pointer.
//
///////////////////////////////////////////////////////////////////////////////

System::IntPtr LayerGlue::layerPtr()
{
  return System::IntPtr ( this->layer() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Clear.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::clear()
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the layer id.
//
///////////////////////////////////////////////////////////////////////////////

int LayerGlue::LayerID::get()
{
  return this->layer()->layerID();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the layer id.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::LayerID::set ( int x )
{
  this->layer()->layerID ( x );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the connection.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::Connection::set ( DT::Minerva::Interfaces::IDatabaseConnection^ connection )
{
  if( nullptr != connection )
  {
    ::Minerva::DB::Connection *c = new ::Minerva::DB::Connection();
    c->ref();
    c->hostname( this->toNativeString ( connection->Hostname ) );
    c->database( this->toNativeString ( connection->Database ) );
    c->username( this->toNativeString ( connection->Username ) );
    c->password( this->toNativeString ( connection->Password ) );
    c->connect();
    this->layer()->connection( c );
    c->unref();
  }

  _connection = connection;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the connection.
//
///////////////////////////////////////////////////////////////////////////////

DT::Minerva::Interfaces::IDatabaseConnection^ LayerGlue::Connection::get()
{
  return _connection;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the table name.
//
///////////////////////////////////////////////////////////////////////////////

System::String^ LayerGlue::Tablename::get()
{
  return this->toManagedString( this->layer()->tablename() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the table name.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::Tablename::set( System::String^ s )
{
  this->layer()->tablename( this->toNativeString( s ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the column to use for the label.
//
///////////////////////////////////////////////////////////////////////////////

System::String^ LayerGlue::LabelColumn::get()
{
  return this->toManagedString( this->layer()->labelColumn() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the column to use for the label.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::LabelColumn::set( System::String^ s )
{
  this->layer()->labelColumn( this->toNativeString( s ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the render bin.
//
///////////////////////////////////////////////////////////////////////////////

int LayerGlue::RenderBin::get()
{
  return this->layer()->renderBin();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the render bin.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::RenderBin::set( int i )
{
  this->layer()->renderBin( i );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the z offset.
//
///////////////////////////////////////////////////////////////////////////////

float LayerGlue::Offset::get()
{
  return this->layer()->zOffset();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the z offset.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::Offset::set( float f )
{
  this->layer()->zOffset( f );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the query.
//
///////////////////////////////////////////////////////////////////////////////

System::String^ LayerGlue::Query::get()
{
  return this->toManagedString( this->layer()->query() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the query.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::Query::set( System::String^ s )
{
  this->layer()->query( this->toNativeString( s ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the color functor.
//
///////////////////////////////////////////////////////////////////////////////

DT::Minerva::Glue::BaseColorFunctor^ LayerGlue::ColorFunctor::get (  )
{
  return _colorFunctor;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the color functor.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::ColorFunctor::set ( DT::Minerva::Glue::BaseColorFunctor^ functor )
{
  if( nullptr != functor )
    this->layer()->colorFunctor( functor->colorFunctor() );
  _colorFunctor = functor;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the legend text.
//
///////////////////////////////////////////////////////////////////////////////

System::String^ LayerGlue::LegendText::get()
{
  return this->toManagedString( this->layer()->legendText() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the legend text.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::LegendText::set( System::String^ s )
{
  this->layer()->legendText( this->toNativeString( s ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Should the label be shown?
//
///////////////////////////////////////////////////////////////////////////////

bool LayerGlue::ShowLabel::get()
{
  return this->layer()->showLabel();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the show label flag.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::ShowLabel::set( bool b )
{
  this->layer()->showLabel( b );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the layer properties.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::_setProperties( LayerGlue ^ layer )
{
  this->Connection = layer->Connection;
  this->Tablename = layer->Tablename;
  this->LabelColumn = layer->LabelColumn;
  this->RenderBin = layer->RenderBin;
  this->Offset = layer->Offset;
  this->Query = layer->Query;
  this->ColorFunctor = layer->ColorFunctor;
  this->LegendText = layer->LegendText;
  this->ShowLabel = layer->ShowLabel;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Should the layer be shown?
//
///////////////////////////////////////////////////////////////////////////////

bool LayerGlue::ShowLayer::get()
{
  return this->layer()->showLayer();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the show layer flag.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::ShowLayer::set( bool b )
{
  this->layer()->showLayer( b );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the color for the label.
//
///////////////////////////////////////////////////////////////////////////////

System::Drawing::Color^ LayerGlue::LabelColor::get()
{
  osg::Vec4 color ( this->layer()->labelColor() );

  System::Drawing::Color ^c = gcnew System::Drawing::Color();
  int a = static_cast < int > ( color.w() * 255 );
  int r = static_cast < int > ( color.x() * 255 );
  int g = static_cast < int > ( color.y() * 255 );
  int b = static_cast < int > ( color.z() * 255 );
  c = System::Drawing::Color::FromArgb( a, r, g, b );

  return c;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the color for the label.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::LabelColor::set( System::Drawing::Color^ color )
{
  osg::Vec4 c ( (float) color->R / 255, (float) color->G / 255, (float) color->B / 255, (float) color->A / 255 );
  this->layer()->labelColor( c );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the label z offset.
//
///////////////////////////////////////////////////////////////////////////////

float LayerGlue::LabelZOffset::get()
{
  return this->layer()->labelZOffset();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the label z offset.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::LabelZOffset::set ( float f )
{
  this->layer()->labelZOffset ( f );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the color column.
//
///////////////////////////////////////////////////////////////////////////////

System::String^ LayerGlue::ColorColumn::get()
{
  return this->toManagedString( this->layer()->colorColumn() );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the color column.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::ColorColumn::set( System::String^ s )
{
  this->layer()->colorColumn( this->toNativeString( s ) );
}

///////////////////////////////////////////////////////////////////////////////
//
//  Get the number of data objects.
//
///////////////////////////////////////////////////////////////////////////////

unsigned int LayerGlue::Number::get()
{
  return this->layer()->number();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the label size.
//
///////////////////////////////////////////////////////////////////////////////

float LayerGlue::LabelSize::get()
{
  return this->layer()->labelSize();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the label size.
//
///////////////////////////////////////////////////////////////////////////////

void LayerGlue::LabelSize::set ( float f )
{
  this->layer()->labelSize ( f );
}
