
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2002, John K. Grant and Perry L. Miller IV.
//  All rights reserved.
//  BSD License: http://www.opensource.org/licenses/bsd-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  Base class for all menu items.
//
///////////////////////////////////////////////////////////////////////////////

#include "Item.h"
#include "Visitor.h"
#include "Errors.h"

#include "Usul/Bits/Bits.h"

///\todo TODO: fix this! //#include "boost/mpl/assert_is_same.hpp"

#include <algorithm>
#include <sstream>
#include <stdexcept>

using namespace MenuKit;


///////////////////////////////////////////////////////////////////////////////
//
//  Default constructor.
//
///////////////////////////////////////////////////////////////////////////////

Item::Item(): Referenced(), 
  _command     ( 0x0 ),
  _text        (),
  _info        (),
  _iconFile    (),
  _parent      ( 0x0 ),
  _flags       ( Item::ENABLED )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

Item::Item ( const std::string &text, const std::string &iconFile ) :
  _command     ( 0x0 ),
  _text        ( text ),
  _info        (),
  _iconFile    ( iconFile ),
  _parent      ( 0x0 ),
  _flags       ( Item::ENABLED )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Copy constructor.
//
///////////////////////////////////////////////////////////////////////////////

Item::Item ( const Item &i ) : Referenced ( i ),
  _command     ( i._command ), 
  _text        ( i._text ), 
  _info        ( i._info ),
  _iconFile    ( i._iconFile ),
  _parent      ( i._parent ),
  _flags       ( i._flags )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor.
//
///////////////////////////////////////////////////////////////////////////////

Item::~Item()
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Assignment.
//
///////////////////////////////////////////////////////////////////////////////

Item& Item::operator = ( const Item &i )
{
  BaseClass::operator = (i);
  _command     = i._command;
  _iconFile    = i._iconFile;
  _text        = i._text;
  _info        = i._info;
  _parent      = i._parent;
  _flags       = i._flags;

  return (*this);
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the flags.
//
///////////////////////////////////////////////////////////////////////////////

unsigned int Item::flags() const
{
  return _flags;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the flags.
//
///////////////////////////////////////////////////////////////////////////////

void Item::flags ( unsigned int f )
{
  _flags = f;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the checked state.
//
///////////////////////////////////////////////////////////////////////////////

bool Item::checked() const
{
  return Usul::Bits::has <unsigned int> ( this->flags(), Item::CHECKED );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the checked state.
//
///////////////////////////////////////////////////////////////////////////////

void Item::checked ( bool e )
{
  if ( e )
    this->flags ( Usul::Bits::add <unsigned int>    ( this->flags(), Item::CHECKED ) );
  else
    this->flags ( Usul::Bits::remove <unsigned int> ( this->flags(), Item::CHECKED ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the toggle state.
//
///////////////////////////////////////////////////////////////////////////////

bool Item::toggle() const
{
  return Usul::Bits::has <unsigned int> ( this->flags(), Item::TOGGLE );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the toggle state.
//
///////////////////////////////////////////////////////////////////////////////

void Item::toggle ( bool e )
{
  if ( e )
    this->flags ( Usul::Bits::add    <unsigned int> ( this->flags(), Item::TOGGLE ) );
  else
    this->flags ( Usul::Bits::remove <unsigned int> ( this->flags(), Item::TOGGLE ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the radio state.
//
///////////////////////////////////////////////////////////////////////////////

bool Item::radio() const
{
  return Usul::Bits::has <unsigned int> ( this->flags(), Item::RADIO );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the radio state.
//
///////////////////////////////////////////////////////////////////////////////

void Item::radio ( bool e )
{
  if ( e )
    this->flags ( Usul::Bits::add <unsigned int>    ( this->flags(), Item::RADIO ) );
  else
    this->flags ( Usul::Bits::remove <unsigned int> ( this->flags(), Item::RADIO ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the enabled state.
//
///////////////////////////////////////////////////////////////////////////////

bool Item::enabled() const
{
  return Usul::Bits::has <unsigned int> ( this->flags(), Item::ENABLED );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the enabled state.
//
///////////////////////////////////////////////////////////////////////////////

void Item::enabled ( bool e )
{
  if ( e )
    this->flags ( Usul::Bits::add    <unsigned int> ( this->flags(), Item::ENABLED ) );
  else
    this->flags ( Usul::Bits::remove <unsigned int> ( this->flags(), Item::ENABLED ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the separator state.
//
///////////////////////////////////////////////////////////////////////////////

bool Item::separator() const
{
  return Usul::Bits::has <unsigned int> ( this->flags(), Item::SEPARATOR );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the separator state.
//
///////////////////////////////////////////////////////////////////////////////

void Item::separator ( bool e )
{
  if ( e )
    this->flags ( Usul::Bits::add    <unsigned int> ( this->flags(), Item::SEPARATOR ) );
  else
    this->flags ( Usul::Bits::remove <unsigned int> ( this->flags(), Item::SEPARATOR ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the expansion state.
//
///////////////////////////////////////////////////////////////////////////////

bool Item::expanded() const
{
  return Usul::Bits::has <unsigned int> ( this->flags(), Item::EXPANDED );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the expansion state.
//
///////////////////////////////////////////////////////////////////////////////

void Item::expanded ( bool e )
{
  if ( e )
    this->flags ( Usul::Bits::add    <unsigned int> ( this->flags(), Item::EXPANDED ) );
  else
    this->flags ( Usul::Bits::remove <unsigned int> ( this->flags(), Item::EXPANDED ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the marked state.
//
///////////////////////////////////////////////////////////////////////////////

bool Item::marked() const
{
  return Usul::Bits::has <unsigned int> ( this->flags(), Item::MARKED );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the marked state.
//
///////////////////////////////////////////////////////////////////////////////

void Item::marked ( bool e )
{
  if ( e )
    this->flags ( Usul::Bits::add    <unsigned int> ( this->flags(), Item::MARKED ) );
  else
    this->flags ( Usul::Bits::remove <unsigned int> ( this->flags(), Item::MARKED ) );
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the command.
//
///////////////////////////////////////////////////////////////////////////////

void Item::command ( Command * command )
{
  _command = command;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the command.
//
///////////////////////////////////////////////////////////////////////////////

Usul::Commands::Command * Item::command ()
{
  return _command.get();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the command.
//
///////////////////////////////////////////////////////////////////////////////

const Usul::Commands::Command * Item::command () const
{
  return _command.get();
}
