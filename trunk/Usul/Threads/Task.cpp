
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2002, Perry L. Miller IV
//  All rights reserved.
//  BSD License: http://www.opensource.org/licenses/bsd-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  Pool task class.
//
///////////////////////////////////////////////////////////////////////////////

#include "Usul/Threads/Task.h"
#include "Usul/Adaptors/MemberFunction.h"
#include "Usul/Errors/Stack.h"
#include "Usul/Functions/SafeCall.h"
#include "Usul/Trace/Trace.h"

using namespace Usul::Threads;


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor
//
///////////////////////////////////////////////////////////////////////////////

Task::Task ( unsigned long id, Callback started, Callback finished, Callback cancelled, Callback error ) : BaseClass(),
  _id          ( id ),
  _cancelledCB ( cancelled ),
  _errorCB     ( error ),
  _finishedCB  ( finished ),
  _startedCB   ( started )
{
  USUL_TRACE_SCOPE;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor
//
///////////////////////////////////////////////////////////////////////////////

Task::~Task()
{
  USUL_TRACE_SCOPE;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Return the id.
//
///////////////////////////////////////////////////////////////////////////////

unsigned long Task::id() const
{
  USUL_TRACE_SCOPE;
  Guard guard ( this->mutex() );
  return _id;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Return the callback.
//
///////////////////////////////////////////////////////////////////////////////

void Task::cancelled()
{
  USUL_TRACE_SCOPE;
  if ( _cancelledCB )
    _cancelledCB();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Return the callback.
//
///////////////////////////////////////////////////////////////////////////////

void Task::error()
{
  USUL_TRACE_SCOPE;
  if ( _errorCB )
    _errorCB();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Return the callback.
//
///////////////////////////////////////////////////////////////////////////////

void Task::finished()
{
  USUL_TRACE_SCOPE;
  if ( _finishedCB )
    _finishedCB();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Return the callback.
//
///////////////////////////////////////////////////////////////////////////////

void Task::started()
{
  USUL_TRACE_SCOPE;
  if ( _startedCB )
    _startedCB();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Return the name.
//
///////////////////////////////////////////////////////////////////////////////

std::string Task::name() const
{
  USUL_TRACE_SCOPE;
  return BaseClass::name();
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the name.
//
///////////////////////////////////////////////////////////////////////////////

void Task::name ( const std::string &n )
{
  USUL_TRACE_SCOPE;
  BaseClass::name ( n );
}
