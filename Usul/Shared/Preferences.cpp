
///////////////////////////////////////////////////////////////////////////////
//
//  Copyright (c) 2002, Perry L. Miller IV
//  All rights reserved.
//  BSD License: http://www.opensource.org/licenses/bsd-license.html
//
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
//
//  Preference class to hold application-defined state.
//
///////////////////////////////////////////////////////////////////////////////

#include "Usul/Shared/Preferences.h"
#include "Usul/Threads/Mutex.h"
#include "Usul/Threads/Guard.h"


using namespace Usul;
using namespace Usul::Shared;

///////////////////////////////////////////////////////////////////////////////
//
//  Macro for guarding access.
//
///////////////////////////////////////////////////////////////////////////////

#define GUARD_THIS Usul::Threads::Guard < Usul::Threads::Mutex > guard ( *_mutex )


///////////////////////////////////////////////////////////////////////////////
//
//  Return the single instance.
//
///////////////////////////////////////////////////////////////////////////////

namespace Usul
{
  namespace Shared
  {
    namespace Detail
    {
      Usul::Shared::Preferences *_instance ( 0x0 );
    }
  }
}


///////////////////////////////////////////////////////////////////////////////
//
//  Constructor.
//
///////////////////////////////////////////////////////////////////////////////

Preferences::Preferences() : 
  _bools(),
  _ints(),
  _uints(),
  _floats(),
  _doubles(),
  _strings(),
  _mutex ( Usul::Threads::Mutex::create() )
{
}


///////////////////////////////////////////////////////////////////////////////
//
//  Destructor.
//
///////////////////////////////////////////////////////////////////////////////

Preferences::~Preferences()
{
  delete _mutex;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Return the single instance. TODO, need to guard this function.
//
///////////////////////////////////////////////////////////////////////////////

Preferences &Preferences::instance()
{
  if ( 0x0 == Usul::Shared::Detail::_instance )
    Usul::Shared::Detail::_instance = new Preferences;
  return *(Usul::Shared::Detail::_instance);
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

bool Preferences::getBool ( const std::string &key )
{
  GUARD_THIS;
  const bool value ( _bools[key] );
  return value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

std::string Preferences::getString ( const std::string &key )
{
  GUARD_THIS;
  const std::string value ( _strings[key] );
  return value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

void Preferences::getString ( const std::string &key, std::string &value )
{
  GUARD_THIS;
  value = _strings[key];
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

int Preferences::getInt ( const std::string &key )
{
  GUARD_THIS;
  const int value ( _ints[key] );
  return value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

unsigned int Preferences::getUint ( const std::string &key )
{
  GUARD_THIS;
  const unsigned int value ( _uints[key] );
  return value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

float Preferences::getFloat ( const std::string &key )
{
  GUARD_THIS;
  const float value ( _floats[key] );
  return value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Get the value.
//
///////////////////////////////////////////////////////////////////////////////

double Preferences::getDouble ( const std::string &key )
{
  GUARD_THIS;
  const double value ( _doubles[key] );
  return value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the value.
//
///////////////////////////////////////////////////////////////////////////////

void Preferences::setBool ( const std::string &key, bool value )
{
  GUARD_THIS;
  _bools[key] = value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the value.
//
///////////////////////////////////////////////////////////////////////////////

void Preferences::setString ( const std::string &key, const std::string &value )
{
  GUARD_THIS;
  _strings[key] = value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the value.
//
///////////////////////////////////////////////////////////////////////////////

void Preferences::setInt ( const std::string &key, int value )
{
  GUARD_THIS;
  _ints[key] = value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the value.
//
///////////////////////////////////////////////////////////////////////////////

void Preferences::setUint ( const std::string &key, unsigned int value )
{
  GUARD_THIS;
  _uints[key] = value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the value.
//
///////////////////////////////////////////////////////////////////////////////

void Preferences::setFloat ( const std::string &key, float value )
{
  GUARD_THIS;
  _floats[key] = value;
}


///////////////////////////////////////////////////////////////////////////////
//
//  Set the value.
//
///////////////////////////////////////////////////////////////////////////////

void Preferences::setDouble ( const std::string &key, double value )
{
  GUARD_THIS;
  _doubles[key] = value;
}
